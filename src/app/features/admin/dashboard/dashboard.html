<div class="dashboard-full">

  <!-- Navbar -->
  <header class="navbar">
    <div class="navbar-left">
      <div class="logo">
        <div class="logo-icon">E</div>
        <span class="logo-text">EgaBank</span>
      </div>
      <select class="navbar-dropdown">
        <option>Finance Dashboard</option>
        <option>Clients</option>
        <option>Comptes</option>
        <option>Transactions</option>
      </select>
    </div>

    <div class="navbar-center">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Rechercher...">
      </div>
    </div>

    <div class="navbar-right">
      <button class="icon-btn notification-btn">
        <i class="fas fa-bell"></i>
        <span class="badge">3</span>
      </button>
      <div class="profile">
        <div class="profile-avatar">{{ currentUserInitials }}</div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="dashboard-content">

    <!-- Top Row - 3 Cards -->
    <div class="top-cards">

      <!-- Card 1: VISA + Account -->
      <div class="card visa-card">
        <div class="card-mini-header">
          <div class="card-title">
            <i class="fas fa-file-invoice-dollar card-icon"></i>
            <span class="card-label">Factures</span>
          </div>
        </div>
        <div class="visa-section">
          <div class="visa-logo">
            <i class="fab fa-cc-visa"></i>
            VISA
          </div>
          <div class="visa-text">Lié au compte principal</div>
          <div class="visa-number">
            <i class="fas fa-credit-card"></i>
            •••• 2710
          </div>
        </div>
        <div class="card-actions">
          <button class="card-btn active">
            <i class="fas fa-download"></i>
            Recevoir
          </button>
          <button class="card-btn">
            <i class="fas fa-paper-plane"></i>
            Envoyer
          </button>
        </div>
        <div class="balance-info">
          <i class="fas fa-calendar-alt"></i>
          <span class="balance-label">Frais mensuel: $50.00</span>
        </div>
      </div>

      <!-- Card 2: Financial Overview -->
      <div class="card financial-card">
        <div class="card-mini-header">
          <div class="card-title">
            <i class="fas fa-chart-line card-icon"></i>
            <span class="card-label">Aperçu Financier</span>
          </div>
          <select class="card-dropdown">
            <option>Hebdomadaire</option>
            <option>Mensuel</option>
            <option>Annuel</option>
          </select>
        </div>
        <div class="financial-main">
          <div class="total-income">
            <span class="label">Revenu Total</span>
            <div class="income-value">
              <i class="fas fa-money-bill-wave"></i>
              <span class="value">{{ totalIncome | number:'1.2-2' }} FCFA</span>
            </div>
          </div>
          <div class="total-paid">
            <div class="paid-value">
              <i class="fas fa-hand-holding-usd"></i>
              <span class="value-paid">{{ totalPaid | number:'1.2-2' }} FCFA</span>
            </div>
            <span class="paid-label">Payé ce mois</span>
          </div>
        </div>
      </div>

      <!-- Card 3: Monthly Performance -->
      <div class="card performance-card">
        <div class="card-mini-header">
          <div class="card-title">
            <i class="fas fa-chart-bar card-icon"></i>
            <span class="card-label">Performance Mensuelle</span>
          </div>
        </div>
        <div class="table-container-small">
          <table class="performance-table">
            <thead>
            <tr>
              <th>Mois</th>
              <th>Revenu ($)</th>
              <th>Dépenses ($)</th>
              <th>Profit ($)</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let row of monthlyPerformance">
              <td>{{ row.month }}</td>
              <td class="income-col">{{ row.income | number:'1.0-0' }}</td>
              <td class="expense-col">{{ row.expenses | number:'1.0-0' }}</td>
              <td [class]="row.profit >= 0 ? 'profit-col positive' : 'profit-col negative'">
                {{ row.profit | number:'1.0-0' }}
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>

    <!-- Middle Row - 3 Charts -->
    <div class="charts-row">

      <!-- Chart 1: Financial Dashboard Overview -->
      <div class="chart-card large">
        <div class="card-header">
          <h3>
            <i class="fas fa-chart-area"></i>
            Aperçu du Tableau de Bord
          </h3>
        </div>
        <div class="chart-container">
          <canvas #lineChart></canvas>
        </div>
      </div>

      <!-- Chart 2: Growth Analytics -->
      <div class="chart-card small">
        <div class="card-header">
          <h3>
            <i class="fas fa-chart-pie"></i>
            Analyse de Croissance
          </h3>
        </div>
        <div class="gauge-container">
          <div class="gauge-circle">
            <svg viewBox="0 0 200 200">
              <circle cx="100" cy="100" r="80" fill="none" stroke="#2a2a2a" stroke-width="20"/>
              <circle cx="100" cy="100" r="80" fill="none" stroke="#000000" stroke-width="20"
                      stroke-dasharray="440" stroke-dashoffset="110"
                      transform="rotate(-90 100 100)"/>
            </svg>
            <div class="gauge-value">25%</div>
          </div>
          <div class="gauge-footer">
            <div class="gauge-info">
              <i class="fas fa-calendar"></i>
              <span class="gauge-label">Année sur année</span>
            </div>
            <span class="gauge-trend positive">
              <i class="fas fa-arrow-up"></i>
              +36%
            </span>
          </div>
        </div>
      </div>

      <!-- Chart 3: Annual Profits -->
      <div class="chart-card small">
        <div class="card-header">
          <h3>
            <i class="fas fa-coins"></i>
            Profits Annuels
          </h3>
        </div>
        <div class="chart-container">
          <canvas #doughnutChart></canvas>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-color" style="background-color: #000000;"></span>
            <span>Compte Courant</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background-color: #333333;"></span>
            <span>Épargne</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background-color: #666666;"></span>
            <span>Investissement</span>
          </div>
        </div>
      </div>

    </div>

    <!-- Bottom Row - Activity Manager (Clients Table) -->
    <div class="activity-card">
      <div class="activity-header">
        <div class="activity-title">
          <i class="fas fa-users"></i>
          <span>Liste des Clients</span>
        </div>
        <div class="activity-actions">
          <button class="filter-btn">
            <i class="fas fa-filter"></i>
            Filtres
          </button>
          <button class="export-btn">
            <i class="fas fa-file-export"></i>
            Exporter
          </button>
          <button class="add-btn-primary" (click)="openAddClientModal()">
            <i class="fas fa-plus"></i>
            Ajouter un client
          </button>
        </div>
      </div>

      <div class="table-container">
        @if (loading) {
          <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Chargement des clients...</p>
          </div>
        } @else if (clients.length === 0) {
          <div class="no-data">
            <i class="fas fa-users-slash"></i>
            <p>Aucun client trouvé</p>
            <button class="add-btn-secondary" (click)="openAddClientModal()">
              <i class="fas fa-plus"></i>
              Ajouter votre premier client
            </button>
          </div>
        } @else {
          <table class="activity-table">
            <thead>
            <tr>
              <th>Client</th>
              <th>Email</th>
              <th>Ville</th>
              <th>Nationalité</th>
              <th>Date de naissance</th>
              <th>Comptes</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
              @for (client of clients; track client.id) {
                <tr class="table-row">
                  <td>
                    <div class="user-cell">
                      <div class="user-avatar">
                        {{ getInitials(client.firstName, client.lastName) }}
                      </div>
                      <div class="user-info">
                        <span class="user-name">{{ client.firstName }} {{ client.lastName }}</span>
                        <span class="user-id">ID: {{ client.id }}</span>
                      </div>
                    </div>
                  </td>

                  <td>
                    <div class="email-cell">
                      <i class="fas fa-envelope"></i>
                      {{ client.email }}
                    </div>
                  </td>
                  <td>
                    <div class="city-cell">
                      <i class="fas fa-map-marker-alt"></i>
                      {{ client.city }}
                    </div>
                  </td>
                  <td>{{ client.nationality }}</td>
                  <td>
                    <div class="date-cell">
                      <i class="fas fa-birthday-cake"></i>
                      {{ client.dateNaissance | date:'dd/MM/yyyy' }}
                    </div>
                  </td>

                  <td>
                    <button class="view-comptes-btn"
                            (click)="viewClientComptes(client.id)">
                      <i class="fas fa-wallet"></i>
                      {{ getClientComptesCount(client.id) }} compte(s)
                    </button>
                  </td>

                  <td>
                    <div class="action-buttons">
                      <button class="action-icon edit" (click)="editClient(client)" title="Modifier">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="action-icon delete" (click)="deleteClient(client.id)" title="Supprimer">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        }
      </div>
    </div>

  </div>
</div>
