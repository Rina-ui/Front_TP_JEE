<!-- Loading State -->
<div class="dashboard-container" *ngIf="loading">
  <div class="loading-wrapper">
    <div class="spinner"></div>
    <p class="loading-text">Chargement de votre espace...</p>
  </div>
</div>

<!-- Dashboard Content -->
<div class="dashboard-container" *ngIf="!loading">

  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="header-title">Bienvenue, {{ userName }} ðŸ‘‹</h1>
      <p class="header-subtitle">GÃ©rez vos finances en toute simplicitÃ©</p>
    </div>
  </div>

  <!-- Comptes Section -->
  <div class="accounts-section">
    <div class="section-header">
      <h2>Mes Comptes</h2>
      <span class="account-count">{{ comptes.length }} compte(s)</span>
    </div>

    <!-- Grille dynamique: 1 colonne si 1 compte, 2 colonnes si 2+, max 3 colonnes -->
    <div class="accounts-grid" [ngClass]="{
      'single-account': comptes.length === 1,
      'two-accounts': comptes.length === 2,
      'multiple-accounts': comptes.length > 2
    }">

      <div *ngFor="let compte of comptes; let i = index"
           class="visa-card"
           [ngClass]="getAccountClass(i)"
           (click)="viewCompteDetails(compte)">

        <div class="visa-card-header">
          <div class="card-chip">
            <div class="chip-line"></div>
            <div class="chip-line"></div>
            <div class="chip-line"></div>
            <div class="chip-line"></div>
          </div>
          <button class="toggle-btn-white" (click)="toggleBalance(); $event.stopPropagation()">
            <svg *ngIf="showBalance" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
            </svg>
            <svg *ngIf="!showBalance" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
            </svg>
          </button>
        </div>

        <div class="visa-card-number">
          <p *ngIf="showBalance">{{ formatCardNumber(compte.accountNumber) }}</p>
          <p *ngIf="!showBalance">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢</p>
        </div>

        <div class="visa-card-details">
          <div class="card-holder">
            <span class="card-label">Titulaire</span>
            <span class="card-value">{{ userName }}</span>
          </div>
          <div class="card-balance">
            <span class="card-label">Solde disponible</span>
            <span class="card-value-large">
              {{ showBalance ? (compte.solde | number:'1.2-2') : 'â€¢â€¢â€¢â€¢â€¢â€¢' }} FCFA
            </span>
          </div>
        </div>

        <div class="visa-card-footer">
          <div class="card-type">
            <span>{{ getCompteTypeLabel(compte.typeCompte) }}</span>
          </div>
          <div class="visa-logo">
            <svg viewBox="0 0 48 16" fill="currentColor">
              <path d="M19.5 3L16.8 13h-2.7L16.8 3h2.7zm11.4 6.5c0-2.6-3.6-2.7-3.6-3.9 0-.4.4-.7 1.2-.8.4 0 1.6-.1 2.9.5l.5-2.4c-.7-.3-1.7-.5-2.9-.5-3 0-5.2 1.6-5.2 3.9 0 1.7 1.5 2.6 2.7 3.2 1.2.6 1.6 1 1.6 1.5 0 .8-.9 1.1-1.8 1.1-1.5 0-2.3-.2-3.5-.7l-.6 2.7c.8.4 2.3.7 3.8.7 3.2 0 5.3-1.6 5.3-4 0-2.8-3.4-3-3.4-4.3zm8.4 3.5h2.3l-1.2-2.9zm4.2 3H46l-2.3-10h-2.4c-.5 0-1 .3-1.2.8l-4.2 9.2h3.2l.6-1.7h3.9l.4 1.7zm-20-10l-2.5 10h-3l-1.2-6.2c-.1-.4-.2-.7-.6-.9-.6-.4-1.6-.7-2.5-.9l.1-.5H9c.7 0 1.3.4 1.5 1.2l1.4 7.4 3.4-8.6h3.3z"/>
            </svg>
          </div>
        </div>

        <div class="card-hover-overlay">
          <span class="hover-text">Cliquez pour voir les dÃ©tails</span>
        </div>
      </div>

      <!-- Empty state si aucun compte -->
      <div class="empty-account-state" *ngIf="comptes.length === 0">
        <div class="empty-icon">ðŸ’³</div>
        <h3>Aucun compte trouvÃ©</h3>
        <p>Contactez votre conseiller pour ouvrir un compte</p>
      </div>
    </div>
  </div>

  <!-- Actions Rapides + Stats -->
  <div class="actions-stats-grid">

    <!-- Actions Rapides -->
    <div class="quick-actions-section">
      <h3 class="section-title">Actions rapides</h3>

      <div class="action-grid">
        <button class="action-btn deposit-btn" (click)="handleQuickAction('deposit')">
          <div class="action-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
          </div>
          <span class="action-label">DÃ©pÃ´t</span>
          <span class="action-desc">Ajouter de l'argent</span>
        </button>

        <button class="action-btn withdraw-btn" (click)="handleQuickAction('withdraw')">
          <div class="action-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
            </svg>
          </div>
          <span class="action-label">Retrait</span>
          <span class="action-desc">Retirer de l'argent</span>
        </button>

        <button class="action-btn transfer-btn" (click)="handleQuickAction('transfer')">
          <div class="action-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
            </svg>
          </div>
          <span class="action-label">Virement</span>
          <span class="action-desc">TransfÃ©rer</span>
        </button>

        <button class="action-btn history-btn" (click)="handleQuickAction('history')">
          <div class="action-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <span class="action-label">Historique</span>
          <span class="action-desc">Voir les transactions</span>
        </button>
      </div>
    </div>

    <!-- Stats du mois -->
    <div class="monthly-stats-card">
      <h3 class="section-title">Statistiques du mois</h3>

      <div class="stats-grid">
        <div class="stat-card income-stat">
          <div class="stat-icon">ðŸ“ˆ</div>
          <div class="stat-content">
            <span class="stat-label">Revenus</span>
            <span class="stat-value">+{{ monthlyIncome | number:'1.0-0' }} FCFA</span>
          </div>
        </div>

        <div class="stat-card expense-stat">
          <div class="stat-icon">ðŸ“‰</div>
          <div class="stat-content">
            <span class="stat-label">DÃ©penses</span>
            <span class="stat-value">-{{ monthlyExpenses | number:'1.0-0' }} FCFA</span>
          </div>
        </div>

        <div class="stat-card balance-stat">
          <div class="stat-icon">ðŸ’°</div>
          <div class="stat-content">
            <span class="stat-label">Solde total</span>
            <span class="stat-value">{{ totalBalance | number:'1.2-2' }} FCFA</span>
          </div>
        </div>

        <div class="stat-card transaction-stat">
          <div class="stat-icon">ðŸ”„</div>
          <div class="stat-content">
            <span class="stat-label">Transactions</span>
            <span class="stat-value">{{ allTransactions.length }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart & Balance -->
  <div class="main-grid">

    <!-- Flux de trÃ©sorerie -->
    <div class="chart-card">
      <div class="card-header">
        <div>
          <h2 class="card-title">
            <svg class="icon-inline" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
            </svg>
            Flux de trÃ©sorerie
          </h2>
          <p class="card-subtitle">Ã‰volution de vos transactions</p>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-bars" *ngIf="chartData.length > 0">
          <div *ngFor="let item of chartData" class="chart-bar-wrapper">
            <div class="chart-bar-inner">
              <div class="chart-bar" [style.height]="getChartHeight(item.value)">
                <div class="chart-tooltip">{{ item.value | number:'1.0-0' }} FCFA</div>
              </div>
            </div>
            <span class="chart-label">{{ item.date }}</span>
          </div>
        </div>
        <div class="empty-chart" *ngIf="chartData.length === 0">
          <p>Pas encore de donnÃ©es</p>
        </div>
      </div>
    </div>

    <!-- RÃ©partition des comptes -->
    <div class="total-balance-card">
      <div class="balance-header">
        <h3>RÃ©partition</h3>
        <div class="balance-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
          </svg>
        </div>
      </div>

      <div class="balance-amount">
        <h2>{{ totalBalance | number:'1.2-2' }} FCFA</h2>
        <p>Solde total combinÃ©</p>
      </div>

      <div class="balance-list" *ngIf="comptes.length > 0">
        <div *ngFor="let compte of comptes" class="balance-item">
          <div class="balance-item-left">
            <div class="balance-dot" [style.background]="compte.typeCompte === 'EPARGNE' ? '#10b981' : '#3b82f6'"></div>
            <span>{{ getCompteTypeLabel(compte.typeCompte) }}</span>
          </div>
          <span class="balance-amount-text">{{ compte.solde | number:'1.2-2' }} FCFA</span>
        </div>
      </div>

      <div class="empty-balance" *ngIf="comptes.length === 0">
        <p>Aucun compte disponible</p>
      </div>
    </div>
  </div>

  <!-- Transactions rÃ©centes -->
  <div class="transactions-card">
    <div class="transactions-header">
      <h2>ActivitÃ©s rÃ©centes</h2>
      <button class="view-all-btn" (click)="viewAllTransactions()" *ngIf="allTransactions.length > 0">
        Voir tout â†’
      </button>
    </div>

    <div class="table-wrapper" *ngIf="recentTransactions.length > 0">
      <table class="transactions-table">
        <thead>
        <tr>
          <th>Transaction</th>
          <th>Date</th>
          <th>Montant</th>
          <th>Statut</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let transaction of recentTransactions">
          <td>
            <div class="transaction-info">
              <div class="transaction-icon" [class.credit]="isCredit(transaction)" [class.debit]="!isCredit(transaction)">
                <svg *ngIf="isCredit(transaction)" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                </svg>
                <svg *ngIf="!isCredit(transaction)" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                </svg>
              </div>
              <div>
                <p class="transaction-name">{{ transaction.type }}</p>
                <p class="transaction-type">{{ formatDate(transaction.dateTransaction) }}</p>
              </div>
            </div>
          </td>
          <td>
            <p class="transaction-date">{{ formatDate(transaction.dateTransaction) }}</p>
          </td>
          <td>
            <p class="transaction-amount" [class.credit]="isCredit(transaction)">
              {{ isCredit(transaction) ? '+' : '-' }}{{ formatAmount(transaction.montant) }} FCFA
            </p>
          </td>
          <td>
              <span class="status-badge completed">
                ValidÃ©e
              </span>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="empty-transactions" *ngIf="recentTransactions.length === 0">
      <div class="empty-icon">ðŸ“Š</div>
      <h3>Aucune transaction</h3>
      <p>Vos transactions apparaÃ®tront ici</p>
    </div>
  </div>

</div>
