<!-- Loading State -->
<div class="dashboard-container" *ngIf="loading">
  <div class="loading-wrapper">
    <div class="spinner"></div>
    <p class="loading-text">Chargement...</p>
  </div>
</div>

<!-- Dashboard Content -->
<div class="dashboard-container" *ngIf="!loading">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="header-title">Tableau de bord</h1>
      <p class="header-subtitle">Bienvenue {{ userName }}, gérez vos comptes facilement</p>
    </div>
    <button class="btn-primary">Nouvelle transaction</button>
  </div>

  <!-- Accounts Cards -->
  <div class="accounts-grid">
    <div *ngFor="let account of accounts; let i = index"
         class="account-card"
         [ngClass]="getAccountClass(i)">
      <div class="account-header">
        <div class="account-type-badge">
          <svg class="account-type-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
          </svg>
          <span>{{ account.type }}</span>
        </div>
        <button class="toggle-btn" (click)="toggleBalance()">
          <svg *ngIf="showBalance" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          <svg *ngIf="!showBalance" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
          </svg>
        </button>
      </div>

      <div class="account-balance-section">
        <p class="balance-label">Solde disponible</p>
        <h3 class="balance-amount">{{ showBalance ? (account.solde | number:'1.2-2') + ' FCFA' : '••••••' }}</h3>
        <p class="account-number-display">{{ account.numero }}</p>
      </div>

      <div class="account-actions">
        <button class="action-btn" (click)="downloadStatement(account.id)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          Télécharger relevé
        </button>
      </div>
    </div>
  </div>

  <div class="main-grid">
    <!-- Cash Flow Chart (GRAPHIQUE) -->
    <div class="chart-card">
      <div class="card-header">
        <div>
          <h2 class="card-title">
            <svg class="icon-inline" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
            </svg>
            Flux de trésorerie
          </h2>
          <p class="card-subtitle">Évolution de vos transactions</p>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-bars">
          <div *ngFor="let item of chartData" class="chart-bar-wrapper">
            <div class="chart-bar-inner">
              <div class="chart-bar" [style.height]="getChartHeight(item.value)">
                <div class="chart-tooltip">{{ item.value }} FCFA</div>
              </div>
            </div>
            <span class="chart-label">{{ item.date }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Total Balance Card -->
    <div class="total-balance-card">
      <div class="balance-header">
        <h3>Solde Total</h3>
        <div class="balance-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
          </svg>
        </div>
      </div>

      <div class="balance-amount">
        <h2>{{ totalBalance | number:'1.2-2' }} FCFA</h2>
        <p>Tous les comptes combinés</p>
      </div>

      <div class="balance-list">
        <div *ngFor="let account of accounts" class="balance-item">
          <span>{{ account.type }}</span>
          <span>{{ account.solde | number:'1.2-2' }} FCFA</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Transactions -->
  <div class="transactions-card">
    <div class="transactions-header">
      <h2>Activités récentes</h2>
      <button class="view-all-btn">Voir tout →</button>
    </div>

    <div class="table-wrapper">
      <table class="transactions-table">
        <thead>
        <tr>
          <th>Transaction</th>
          <th>Date</th>
          <th>Montant</th>
          <th>Statut</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let transaction of transactions">
          <td>
            <div class="transaction-info">
              <div class="transaction-icon" [class.credit]="isCredit(transaction)" [class.debit]="!isCredit(transaction)">
                <svg *ngIf="isCredit(transaction)" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                </svg>
                <svg *ngIf="!isCredit(transaction)" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                </svg>
              </div>
              <div>
                <p class="transaction-name">{{ transaction.description || transaction.type }}</p>
                <p class="transaction-type">{{ transaction.type }}</p>
              </div>
            </div>
          </td>
          <td>
            <p class="transaction-date">{{ formatDate(transaction.dateTransaction) }}</p>
          </td>
          <td>
            <p class="transaction-amount" [class.credit]="isCredit(transaction)">
              {{ isCredit(transaction) ? '+' : '-' }}{{ formatAmount(transaction.montant) }} FCFA
            </p>
          </td>
          <td>
              <span class="status-badge" [class.completed]="transaction.statut === 'VALIDEE'" [class.failed]="transaction.statut !== 'VALIDEE'">
                {{ transaction.statut }}
              </span>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
